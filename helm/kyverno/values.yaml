# We install CRDs through a Job with the helm specific crd folder.
crds:
  install: true
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 750m
      memory: 1024Mi

image:
  registry: docker.io

# Additional options defined in charts/kyverno/values.yaml. Upstream docs: https://github.com/kyverno/kyverno
kyverno:
  # Labels on the Deployment. See podLabels for Pod-level labels.
  customLabels:
    giantswarm.io/service-type: "managed"
    giantswarm.io/monitoring_basic_sli: "true"
    application.giantswarm.io/team: "shield"

  # We do not want Kyverno to install these CRDs.
  # Kyverno managed them through helm templates which clashes with chart-operator.
  installCRDs: false
  fullnameOverride: kyverno
  image:
    registry: docker.io
    repository: giantswarm/kyverno
    pullPolicy: IfNotPresent
  initImage:
    registry: docker.io
    repository: giantswarm/kyvernopre
  replicaCount: 3
  resources:
    limits:
      memory: 1024Mi
    requests:
      cpu: 100m
      memory: 256Mi
  initResources:
    limits:
      cpu: 100m
      memory: 256Mi
    requests:
      cpu: 10m
      memory: 64Mi
  metricsService:
    create: true
    type: ClusterIP
    port: 8000
    annotations:
      giantswarm.io/monitoring-port: "8000"
      giantswarm.io/monitoring-app-label: "kyverno"
  podDisruptionBudget:
    maxUnavailable: 1
    minAvailable: ""
  priorityClassName: "giantswarm-critical"
  psp:
    enabled: true
  rbac:
    serviceAccount:
      name: "kyverno"  # Added so that we can create a PSP allowing emptyDir and seccomp profiles. Can be removed when PSPs are removed.
  extraArgs:
    - -clientRateLimitQPS=75
    - -clientRateLimitBurst=150

# Additional options defined in charts/policy-reporter/values.yaml. Upstream docs: https://github.com/kyverno/policy-reporter
policy-reporter:
  verticalPodAutoscaler:
    enabled: true
  image:
    registry: docker.io
    repository: giantswarm/policy-reporter
  resources:
    limits:
      cpu: 30m
      memory: 100Mi
    requests:
      cpu: 5m
      memory: 30Mi
  serviceAccount:
    name: "policyreporter-sa"  # Only needed to support adding a PSP. Can be removed when PSPs are disabled.

  ui:
    enabled: true
    image:
      registry: docker.io
      repository: giantswarm/policy-reporter-ui
    plugins:
      kyverno: true
    resources:
      limits:
        cpu: 10m
        memory: 16Mi
      requests:
        cpu: 1m
        memory: 8Mi
    serviceAccount:
      create: true
      name: "policyreporter-ui-sa"  # Only needed to support adding a PSP. Can be removed when PSPs are disabled.

  kyvernoPlugin:
    enabled: true
    image:
      registry: docker.io
      repository: giantswarm/policy-reporter-kyverno-plugin
    resources:
      limits:
        cpu: 10m
        memory: 30Mi
      requests:
        cpu: 1m
        memory: 15Mi
    serviceAccount:
      name: "policyreporter-plugin-sa"  # Only needed to support adding a PSP. Can be removed when PSPs are disabled.

  global:
    plugins:
      kyverno: true

    labels:
      giantswarm.io/service-type: "managed"
      giantswarm.io/monitoring_basic_sli: "true"
      application.giantswarm.io/team: "shield"

  monitoring:
    enabled: false
    namespace: monitoring

  # Create a PSP and ClusterRoleBinding for PolicyReporter.
  psp:
    enabled: true
